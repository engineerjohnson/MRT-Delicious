import{q as le,x as m,A as M,M as ae,N as ie,J as U,O as ce,P as re,Q as ue,G as de,_ as pe,o as v,H as D,d as L,w as k,c as w,j as W,b as l,S as F,f as E,T as H,U as fe,r as X,p as ve,l as me,C as he,F as A,h as _e,s as P,e as be,t as I,i as q,V as ge}from"./index-28460db4.js";import{U as we,_ as ye,L as ke}from"./PaginationView-7f8b9f7f.js";import{T as $}from"./Toast-0e28cdc5.js";import{L as Se}from"./index-c262e860.js";import{F as Le}from"./FormGroup-35319183.js";const $e=le("modal",()=>{const e=m(!1),t=m(null);function s(){e.value=!0}function n(){e.value=!1}return M(()=>e.value,i=>{i?document.querySelector("body").classList.add("overflow-hidden"):setTimeout(()=>{document.querySelector("body").classList.remove("overflow-hidden")},300)}),{modalState:e,currentName:t,modalShow:s,modalClose:n}});function J(e){return ae()?(ie(e),!0):!1}function C(e){return typeof e=="function"?e():U(e)}const Q=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const xe=Object.prototype.toString,Ce=e=>xe.call(e)==="[object Object]",N=()=>{},B=Me();function Me(){var e,t;return Q&&((e=window==null?void 0:window.navigator)==null?void 0:e.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((t=window==null?void 0:window.navigator)==null?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}const z={mounted:"mounted",updated:"updated",unmounted:"unmounted"};function Oe(...e){if(e.length!==1)return ce(...e);const t=e[0];return typeof t=="function"?re(ue(()=>({get:t,set:N}))):m(t)}function x(e){var t;const s=C(e);return(t=s==null?void 0:s.$el)!=null?t:s}const K=Q?window:void 0;function V(...e){let t,s,n,i;if(typeof e[0]=="string"||Array.isArray(e[0])?([s,n,i]=e,t=K):[t,s,n,i]=e,!t)return N;Array.isArray(s)||(s=[s]),Array.isArray(n)||(n=[n]);const f=[],u=()=>{f.forEach(g=>g()),f.length=0},c=(g,b,a,r)=>(g.addEventListener(b,a,r),()=>g.removeEventListener(b,a,r)),d=M(()=>[x(t),C(i)],([g,b])=>{if(u(),!g)return;const a=Ce(b)?{...b}:b;f.push(...s.flatMap(r=>n.map(h=>c(g,r,h,a))))},{immediate:!0,flush:"post"}),y=()=>{d(),u()};return J(y),y}let R=!1;function G(e,t,s={}){const{window:n=K,ignore:i=[],capture:f=!0,detectIframe:u=!1}=s;if(!n)return;B&&!R&&(R=!0,Array.from(n.document.body.children).forEach(a=>a.addEventListener("click",N)),n.document.documentElement.addEventListener("click",N));let c=!0;const d=a=>i.some(r=>{if(typeof r=="string")return Array.from(n.document.querySelectorAll(r)).some(h=>h===a.target||a.composedPath().includes(h));{const h=x(r);return h&&(a.target===h||a.composedPath().includes(h))}}),g=[V(n,"click",a=>{const r=x(e);if(!(!r||r===a.target||a.composedPath().includes(r))){if(a.detail===0&&(c=!d(a)),!c){c=!0;return}t(a)}},{passive:!0,capture:f}),V(n,"pointerdown",a=>{const r=x(e);c=!d(a)&&!!(r&&!a.composedPath().includes(r))},{passive:!0}),u&&V(n,"blur",a=>{setTimeout(()=>{var r;const h=x(e);((r=n.document.activeElement)==null?void 0:r.tagName)==="IFRAME"&&!(h!=null&&h.contains(n.document.activeElement))&&t(a)},0)})].filter(Boolean);return()=>g.forEach(a=>a())}const Ve={[z.mounted](e,t){const s=!t.modifiers.bubble;if(typeof t.value=="function")e.__onClickOutside_stop=G(e,t.value,{capture:s});else{const[n,i]=t.value;e.__onClickOutside_stop=G(e,n,Object.assign({capture:s},i))}},[z.unmounted](e){e.__onClickOutside_stop()}};function T(e){return typeof Window<"u"&&e instanceof Window?e.document.documentElement:typeof Document<"u"&&e instanceof Document?e.documentElement:e}function Z(e){const t=window.getComputedStyle(e);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&e.clientWidth<e.scrollWidth||t.overflowY==="auto"&&e.clientHeight<e.scrollHeight)return!0;{const s=e.parentNode;return!s||s.tagName==="BODY"?!1:Z(s)}}function De(e){const t=e||window.event,s=t.target;return Z(s)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const O=new WeakMap;function Ee(e,t=!1){const s=m(t);let n=null,i;M(Oe(e),c=>{const d=T(C(c));if(d){const y=d;O.get(y)||O.set(y,i),s.value&&(y.style.overflow="hidden")}},{immediate:!0});const f=()=>{const c=T(C(e));!c||s.value||(B&&(n=V(c,"touchmove",d=>{De(d)},{passive:!1})),c.style.overflow="hidden",s.value=!0)},u=()=>{var c;const d=T(C(e));!d||!s.value||(B&&(n==null||n()),d.style.overflow=(c=O.get(d))!=null?c:"",O.delete(d),s.value=!1)};return J(u),de({get(){return s.value},set(c){c?f():u()}})}function Ne(){let e=!1;const t=m(!1);return(s,n)=>{if(t.value=n.value,e)return;e=!0;const i=Ee(s,n.value);M(t,f=>i.value=f)}}Ne();const ee=e=>(ve("data-v-79757e9b"),e=e(),me(),e),Ae={key:0,class:"modal"},Pe={class:"border rounded w-50 bg-white modalOverflow"},Ie={class:"d-flex justify-content-between border-bottom p-3"},Te={class:"border-bottom px-3"},We=ee(()=>l("button",{class:"btn btn-primary",type:"submit"},"確定",-1)),Be=ee(()=>l("div",{class:"model-bg"},null,-1)),Ue={__name:"ModalView",props:{show:Boolean,submit:Function,modalName:String},emits:["update:show"],setup(e,{emit:t}){const s=e;function n(){t("update:show",!1)}const i=$e();M(()=>i.modalState,u=>{u?(i.currentName=s.modalName,console.log(i.currentName)):i.currentName===s.modalName&&(i.currentName=null)});function f(u){console.log(u),Object.keys(u).length===0?s.submit():s.submit(u)}return(u,c)=>{const d=X("VForm");return v(),D(fe,{to:"body"},[L(H,{name:"modal",duration:200},{default:k(()=>[s.show?(v(),w("div",Ae,[W((v(),w("div",Pe,[l("div",Ie,[F(u.$slots,"modal-head",{},void 0,!0),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:n})]),l("div",Te,[L(d,{onSubmit:f,class:"mt-3"},{default:k(()=>[F(u.$slots,"modal-body",{},void 0,!0),l("div",{class:"p-3 text-end"},[l("button",{class:"btn btn-secondary me-2",type:"button",onClick:n}," 取消 "),We])]),_:3})])])),[[U(Ve),n]])])):E("",!0)]),_:3}),s.show?(v(),D(H,{key:0,name:"model-bg",duration:{enter:0,leave:200}},{default:k(()=>[Be]),_:1})):E("",!0)])}}},Y=pe(Ue,[["__scopeId","data-v-79757e9b"]]);const je={class:"modal-outside-style"},Fe={class:"table-responsive-xl"},He=l("h5",{class:"mt-4"},"產品列表",-1),qe={class:"text-end me-2"},ze={class:"table caption-top"},Re=l("thead",null,[l("tr",null,[l("th",{style:{width:"20%"}},"分類"),l("th",{style:{width:"30%"}},"名稱"),l("th",{style:{width:"25%"}},"售價"),l("th",{style:{width:"15%"}},"狀態"),l("th",{style:{width:"10%"}})])],-1),Ge={key:0,class:"table-group-divider"},Ye={class:"vertical-align"},Xe={class:"badge bg-secondary"},Je={class:"vertical-align"},Qe={class:"vertical-align"},Ke={class:"vertical-align"},Ze={key:0,class:"badge bg-success"},et={key:1,class:"badge bg-danger"},tt={class:"vertical-align"},ot=["onClick"],st=l("svg",{class:"svg-opacity",xmlns:"http://www.w3.org/2000/svg",height:"16",width:"16",viewBox:"0 0 512 512"},[l("path",{d:"M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"})],-1),nt=[st],lt=["onClick"],at=l("svg",{class:"svg-opacity",xmlns:"http://www.w3.org/2000/svg",height:"16",width:"14",viewBox:"0 0 448 512"},[l("path",{d:"M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"})],-1),it=[at],ct=l("h5",{class:"m-0"},"刪除商品",-1),rt=l("p",{class:"m-0"},"是否要刪除商品?!",-1),ut=l("h5",{class:"m-0"},"編輯商品",-1),ht={__name:"AdminProductsList",setup(e){const t=m(!1),{checkLogin:s}=we(),n=m(""),i=m(!1),f=m(null);function u(p=1){s(),f.value=p,!(n.value&&(p==0||p>n.value.pagination.total_pages))&&(i.value=!0,P.get(`https://vue3-course-api.hexschool.io/v2/api/deliciousfood/admin/products?page=${p}`).then(o=>{o.data.success?n.value=o.data:$.fire({title:"無法取得產品資料，請重新整理畫面",icon:"error"})}).catch(o=>{$.fire({title:`${o.message}`,icon:"error"})}).finally(()=>{i.value=!1}))}const c=m(null),d=m(!1);function y(p){c.value=p,d.value=!0}function g(){t.value=!0,s(),P.delete(`https://vue3-course-api.hexschool.io/v2/api/deliciousfood/admin/product/${c.value}`).then(p=>{$.fire({title:`${p.data.message}`,icon:"success"}),u(f.value)}).catch(p=>{$.fire({title:`${p.message}`,icon:"error"})}).finally(()=>{t.value=!1,d.value=!1})}const b=m(!1),a=m(""),r=m(null);function h(p){a.value=p,b.value=!0;const o=te(p)[0];r.value={title:o==null?void 0:o.title,category:o==null?void 0:o.category,unit:o==null?void 0:o.unit,price:o==null?void 0:o.price,origin_price:o==null?void 0:o.origin_price,description:o==null?void 0:o.description,content:o==null?void 0:o.content,imageUrl:o==null?void 0:o.imageUrl,is_enabled:o==null?void 0:o.is_enabled}}function te(p){return n.value.products.filter(o=>o.id===p)}function oe(p){t.value=!0;const o={data:{...p,price:Number(p.price),origin_price:Number(p.origin_price)}};P.put(`https://vue3-course-api.hexschool.io/v2/api/deliciousfood/admin/product/${a.value}`,o).then(S=>{console.log(S),$.fire({title:`${S.data.message}`,icon:"success"}),u(f.value)}).catch(S=>{console.log(S),$.fire({title:`${S.message}`,icon:"error"})}).finally(()=>{t.value=!1,b.value=!1})}const se=[{label:"標題",name:"title",placeholder:"請輸入產品名稱",rules:"required",as:"input",type:"text"},{label:"餐飲類型",name:"category",as:"select",value:"日式",options:[{label:"日式",value:"日式"},{label:"西餐",value:"西餐"},{label:"中式",value:"中式"},{label:"甜食",value:"甜食"}]},{label:"站別",name:"unit",as:"select",value:"大慶站",options:[{label:"大慶站",value:"大慶站"},{label:"豐樂公園站",value:"豐樂公園站"},{label:"文華高中站",value:"文華高中站"},{label:"水安宮站",value:"水安宮站"},{label:"文心崇德站",value:"文心崇德站"},{label:"松竹站",value:"松竹站"}]},{label:"銷售價",name:"price",rules:"required|integer",as:"input",type:"number"},{label:"原價",name:"origin_price",rules:"required|integer",as:"input",type:"number"},{label:"商品描述",name:"description",as:"textarea"},{label:"商品內容",name:"content",as:"textarea"},{label:"商品圖片",name:"imageUrl",as:"textarea"},{label:"是否啟用",name:"is_enabled",as:"checkbox",type:"checkbox"}];return he(()=>{u()}),(p,o)=>{const S=X("RouterLink"),j=ge("tooltip");return v(),w(A,null,[L(U(Se),{active:t.value,"onUpdate:active":o[0]||(o[0]=_=>t.value=_),loader:"dots"},null,8,["active"]),l("div",je,[i.value?(v(),D(ke,{key:0})):(v(),w(A,{key:1},[l("div",Fe,[He,l("div",qe,[L(S,{to:"/backend/addProduct",class:"btn btn-outline-danger"},{default:k(()=>[be(" 新增產品 ")]),_:1})]),l("table",ze,[Re,n.value.products?(v(),w("tbody",Ge,[(v(!0),w(A,null,_e(n.value.products,_=>(v(),w("tr",{key:_.id},[l("td",Ye,[l("span",Xe,I(_.unit),1)]),l("td",Je,I(_.title),1),l("td",Qe,I(_.price),1),l("td",Ke,[_.is_enabled?(v(),w("span",Ze,"已上架")):(v(),w("span",et,"未上架"))]),l("td",tt,[W((v(),w("button",{class:"p-0 me-2 btn-icon",type:"button",onClick:q(ne=>h(_.id),["stop"])},nt,8,ot)),[[j,"編輯"]]),W((v(),w("button",{class:"btn-icon p-0",type:"button",onClick:q(ne=>y(_.id),["stop"])},it,8,lt)),[[j,"刪除"]])])]))),128))])):E("",!0)])]),L(ye,{"on-submit":u,pagination:n.value.pagination},null,8,["pagination"])],64))]),L(Y,{show:d.value,"onUpdate:show":o[1]||(o[1]=_=>d.value=_),submit:g},{"modal-head":k(()=>[ct]),"modal-body":k(()=>[rt]),_:1},8,["show"]),L(Y,{show:b.value,"onUpdate:show":o[2]||(o[2]=_=>b.value=_),submit:oe},{"modal-head":k(()=>[ut]),"modal-body":k(()=>[r.value?(v(),D(Le,{key:0,"form-schema":se,pageDate:r.value},null,8,["pageDate"])):E("",!0)]),_:1},8,["show"])],64)}}};export{ht as default};
